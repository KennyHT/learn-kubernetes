



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Deploying Declarively - Learn Kubernetes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#deploying-declaratively-with-the-kubernetes-dashboard" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Learn Kubernetes" class="md-header-nav__button md-logo">
          
            <i class="md-icon">class</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Learn Kubernetes
              </span>
              <span class="md-header-nav__topic">
                Deploying Declarively
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Learn Kubernetes" class="md-nav__button md-logo">
      
        <i class="md-icon">class</i>
      
    </a>
    Learn Kubernetes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Deploying Declarively
      </label>
    
    <a href="./" title="Deploying Declarively" class="md-nav__link md-nav__link--active">
      Deploying Declarively
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-install-it" title="Step 1. Install it" class="md-nav__link">
    Step 1. Install it
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-kubernetes-dashboard-access" title="Step 2. Kubernetes Dashboard access" class="md-nav__link">
    Step 2. Kubernetes Dashboard access
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-21-kubernetes-dashboard-with-port-forwarding" title="Step 2.1 Kubernetes Dashboard with Port Forwarding" class="md-nav__link">
    Step 2.1 Kubernetes Dashboard with Port Forwarding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-22-kubernetes-dashboard-with-kubectl-proxy" title="Step 2.2 Kubernetes Dashboard with kubectl proxy" class="md-nav__link">
    Step 2.2 Kubernetes Dashboard with kubectl proxy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-access-the-dashboard" title="Step 3. Access the Dashboard" class="md-nav__link">
    Step 3. Access the Dashboard
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-dashboard-in-production" title="Kubernetes Dashboard in Production" class="md-nav__link">
    Kubernetes Dashboard in Production
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../reconciliation-loop-testing/" title="Reconciliation Loop Testing" class="md-nav__link">
      Reconciliation Loop Testing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../namespaces/" title="Namespaces" class="md-nav__link">
      Namespaces
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../pods/" title="Pods" class="md-nav__link">
      Pods
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../configmaps/" title="ConfigMaps" class="md-nav__link">
      ConfigMaps
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../secrets/" title="Secrets" class="md-nav__link">
      Secrets
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../services/" title="Services" class="md-nav__link">
      Services
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../replicasets/" title="ReplicaSets" class="md-nav__link">
      ReplicaSets
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../deployments/" title="Deployments" class="md-nav__link">
      Deployments
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-install-it" title="Step 1. Install it" class="md-nav__link">
    Step 1. Install it
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-kubernetes-dashboard-access" title="Step 2. Kubernetes Dashboard access" class="md-nav__link">
    Step 2. Kubernetes Dashboard access
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-21-kubernetes-dashboard-with-port-forwarding" title="Step 2.1 Kubernetes Dashboard with Port Forwarding" class="md-nav__link">
    Step 2.1 Kubernetes Dashboard with Port Forwarding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-22-kubernetes-dashboard-with-kubectl-proxy" title="Step 2.2 Kubernetes Dashboard with kubectl proxy" class="md-nav__link">
    Step 2.2 Kubernetes Dashboard with kubectl proxy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-access-the-dashboard" title="Step 3. Access the Dashboard" class="md-nav__link">
    Step 3. Access the Dashboard
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-dashboard-in-production" title="Kubernetes Dashboard in Production" class="md-nav__link">
    Kubernetes Dashboard in Production
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="deploying-declaratively-with-the-kubernetes-dashboard">Deploying declaratively with the Kubernetes dashboard<a class="headerlink" href="#deploying-declaratively-with-the-kubernetes-dashboard" title="Permanent link">&para;</a></h1>
<p>The Kubernetes dashboard helps to visualize understand what is happening with your deployments and the cluster itself.</p>
<p>We're going to install it as an example of how we deploy things declaritively in Kubernetes.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note: This is not a production quality setup for the dashboard.</p>
<p>This article from Heptio is essential reading for <a href="https://blog.heptio.com/on-securing-the-kubernetes-dashboard-16b09b1b7aca">securing the Kubernetes dashboard</a>.</p>
</div>
<h2 id="step-1-install-it">Step 1. Install it<a class="headerlink" href="#step-1-install-it" title="Permanent link">&para;</a></h2>
<p>We’re use the kubectl (Kube Control) CLI tool to install a bunch of objects in the kube-system namespace.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard.yaml
</pre></div>
</td></tr></table>

<p>By the end of the course, you’ll understand most, if not all of what is in that file!</p>
<h2 id="step-2-kubernetes-dashboard-access">Step 2. Kubernetes Dashboard access<a class="headerlink" href="#step-2-kubernetes-dashboard-access" title="Permanent link">&para;</a></h2>
<p>Even for our development environment, we don’t want to expose the dashboard publicly, so we have two simple options:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl proxy
</pre></div>
</td></tr></table>

<p>or</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl port-forward
</pre></div>
</td></tr></table>

<p>I prefer the port-forward option as when using Docker for Desktop, you access it at localhost:<port> and that’s it.</p>
<p>kubectl proxy might be a good choice if the self-signed cert gives you grief or if you don’t want to do port forwarding.</p>
<p>It’s up to you as we’ll use both.</p>
<h3 id="step-21-kubernetes-dashboard-with-port-forwarding">Step 2.1 Kubernetes Dashboard with Port Forwarding<a class="headerlink" href="#step-21-kubernetes-dashboard-with-port-forwarding" title="Permanent link">&para;</a></h3>
<p>The kubectl port-forward command needs the name of the pod, the port on the host machine to forward traffic from and port on the pod to forward traffic too.</p>
<p>Note: The following code presumes the existence of bash so if you’re on Windows, you’ll have to grab the pod name and insert it into the port forward command manually. Sorry. Perhaps it’s time to install the Windows SubShell for Linux?</p>
<p>Grab the name fo the pod</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kube_dashboard_name=$(kubectl get pods --namespace=kube-system | grep kubernetes-dashboard | awk &#39;{print $1}&#39;)
</pre></div>
</td></tr></table>

<p>Setup the port forwarding</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl port-forward <span class="cp">${</span><span class="n">kube_dashboard_name</span><span class="cp">}</span> 30000:8443 --namespace=kube-system
</pre></div>
</td></tr></table>

<p>Then you can access the dashboard at https://localhost:30000</p>
<p>Want to run the port forwarding in the background with a single command?</p>
<p>From the learn-kubernetes directory.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>make k8s-dashboard-up
</pre></div>
</td></tr></table>

<p>To kill the port forwarding process and remove the dashboard.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>make k8s-dashboard-down
</pre></div>
</td></tr></table>

<h3 id="step-22-kubernetes-dashboard-with-kubectl-proxy">Step 2.2 Kubernetes Dashboard with kubectl proxy<a class="headerlink" href="#step-22-kubernetes-dashboard-with-kubectl-proxy" title="Permanent link">&para;</a></h3>
<p>The command is easy to remember, the URL not so much.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl proxy
</pre></div>
</td></tr></table>

<p>Then go to http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/overview</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The kubectl proxy command is great for accessing any service running on your cluster so it’s useful beyond accessing the dashboard.</p>
</div>
<p>For example, you could access a service of type ClusterIP during development instead of NodePort or LoadBalancer.</p>
<h2 id="step-3-access-the-dashboard">Step 3. Access the Dashboard<a class="headerlink" href="#step-3-access-the-dashboard" title="Permanent link">&para;</a></h2>
<p>If this is the first time you’ve accessed the dashboard, you’ll be greeted with a setup screen.</p>
<p>We’re going to click <em>SKIP</em> as it’s just for our private development purposes.</p>
<h2 id="kubernetes-dashboard-in-production">Kubernetes Dashboard in Production<a class="headerlink" href="#kubernetes-dashboard-in-production" title="Permanent link">&para;</a></h2>
<p>Never expose it publicly.</p>
<p>Access should be controlled via a Service token.
https://blog.heptio.com/on-securing-the-kubernetes-dashboard-16b09b1b7aca#0886</p>
<p>Finally, use it as a read-only dashboard, not as a way to manage your cluster.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../setup/" title="Setup" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Setup
              </span>
            </div>
          </a>
        
        
          <a href="../reconciliation-loop-testing/" title="Reconciliation Loop Testing" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Reconciliation Loop Testing
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>