



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.3, mkdocs-material-3.0.4">
    
    
      
        <title>Pods - Learn Kubernetes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="blue-grey">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#pods-lab" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Learn Kubernetes" class="md-header-nav__button md-logo">
          
            <i class="md-icon">chrome_reader_mode</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Learn Kubernetes
              </span>
              <span class="md-header-nav__topic">
                Pods
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Learn Kubernetes" class="md-nav__button md-logo">
      
        <i class="md-icon">chrome_reader_mode</i>
      
    </a>
    Learn Kubernetes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../namespaces/" title="Namespaces" class="md-nav__link">
      Namespaces
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Pods
      </label>
    
    <a href="./" title="Pods" class="md-nav__link md-nav__link--active">
      Pods
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introducing-the-kubernetes-up-and-running-demo-kuard-pod" title="Introducing the Kubernetes Up and Running Demo (kuard) Pod" class="md-nav__link">
    Introducing the Kubernetes Up and Running Demo (kuard) Pod
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod-names" title="Pod names" class="md-nav__link">
    Pod names
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-a-pod" title="Accessing a Pod" class="md-nav__link">
    Accessing a Pod
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-debugging-pod" title="A debugging Pod" class="md-nav__link">
    A debugging Pod
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../services/" title="Services" class="md-nav__link">
      Services
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../replicasets/" title="ReplicaSets" class="md-nav__link">
      ReplicaSets
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../deployments/" title="Deployments" class="md-nav__link">
      Deployments
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introducing-the-kubernetes-up-and-running-demo-kuard-pod" title="Introducing the Kubernetes Up and Running Demo (kuard) Pod" class="md-nav__link">
    Introducing the Kubernetes Up and Running Demo (kuard) Pod
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod-names" title="Pod names" class="md-nav__link">
    Pod names
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-a-pod" title="Accessing a Pod" class="md-nav__link">
    Accessing a Pod
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-debugging-pod" title="A debugging Pod" class="md-nav__link">
    A debugging Pod
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="pods-lab">Pods Lab<a class="headerlink" href="#pods-lab" title="Permanent link">&para;</a></h1>
<p>In this lab, we will deploy a Pod, the unit of compute to our Kubernetes cluster.</p>
<p>You will notice that we <strong>always</strong> use the declarative form for changing the state of our Kubernetes cluster and I strongly encourage you to always do the same.</p>
<p>See the page on <a href="https://kubernetes.io/docs/concepts/overview/object-management-kubectl/declarative-config/" target="_blank">Object Management using kubetcl</a> for more info.</p>
<h2 id="introducing-the-kubernetes-up-and-running-demo-kuard-pod">Introducing the Kubernetes Up and Running Demo (kuard) Pod<a class="headerlink" href="#introducing-the-kubernetes-up-and-running-demo-kuard-pod" title="Permanent link">&para;</a></h2>
<p>From the excellent <a href="https://www.amazon.com/Kubernetes-Running-Dive-Future-Infrastructure/dp/1491935677" target="_blank">Kubernetes Up and Running</a> book, we're going to use this container to demonstrate many of Kubernetes Pod management features.</p>
<p>Deploy our kuard Pod:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl apply -f manifests/pod.yaml
</pre></div>
</td></tr></table>

<p>Verify that the container is running in the Pod and is listening on port 8080:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">kubectl get pods kuard-pod --template=&#39;</span><span class="cp">{{</span><span class="o">(</span><span class="nv">index</span> <span class="o">(</span><span class="nv">index</span> <span class="nv">.spec.containers</span> <span class="m">0</span><span class="o">)</span><span class="nv">.ports</span> <span class="m">0</span><span class="o">)</span><span class="nv">.containerPort</span><span class="cp">}}{{</span><span class="s2">&quot;\n&quot;</span><span class="cp">}}</span><span class="x">&#39;</span>
<span class="x"># &gt;&gt;&gt; 8080</span>
</pre></div>
</td></tr></table>

<h2 id="pod-names">Pod names<a class="headerlink" href="#pod-names" title="Permanent link">&para;</a></h2>
<p>Pod names must be unique for a namespace.</p>
<p>For fun, let's deploy the <code>kuard-pod</code> into the <code>default</code> namespace.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl apply -f manifests/pod.yaml --namespace=default
</pre></div>
</td></tr></table>

<p>No complaints about the Pod having the same name as its in a different namespace. </p>
<p>Let's now delete it as we'll be using the <code>learn-k8s</code> namespace for this training.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl delete -f manifests/pod.yaml --namespace=default
</pre></div>
</td></tr></table>

<p>For development purposes, often you only need a single Pod exposed. If so, then you can just deploy the Pod and port forward from your host.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl port-forward kuard-pod 8080:8080
</pre></div>
</td></tr></table>

<p>View the API in your browser at http://localhost:8080/</p>
<p>Kill the port-forwarding process in your terminal using a SIGINT (Ctrl+C).</p>
<p>Let's inspect our Pod (in a few different ways):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl get pods kuard-pod
kubectl get pods kuard-pod -o wide
kubectl describe pods kuard-pod
kubectl get pods kuard-pod -o yaml
kubectl get pods kuard-pod -o json | jq
</pre></div>
</td></tr></table>

<p>Docker commands such as <code>logs</code> and <code>exec</code> have Pod equivalents.</p>
<p>Let's view the logs for our Pod:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl logs kuard-pod
</pre></div>
</td></tr></table>

<p>This works, but beware. If we had more than one container in our Pod, it wouldn't as kubectl would not know which container we want logs for. To do this in a way which will always work, let's use the container name.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl logs kuard-pod kuard
</pre></div>
</td></tr></table>

<p>If we want to tail the logs, we need to supply the <code>-f</code> flag.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl logs kuard-pod kuard -f
</pre></div>
</td></tr></table>

<p>We can see regular requests for <code>/healthy</code> and <code>/ready</code>. This is being called by the <code>kubelet</code> that is responsible for monitoring the health of the pods on each worker node.</p>
<h2 id="accessing-a-pod">Accessing a Pod<a class="headerlink" href="#accessing-a-pod" title="Permanent link">&para;</a></h2>
<p>Wouldn't it be great if we could get into a container inside our Pod, as easily as we the <code>docker container exec</code> command. Turns out we can.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl exec -it kuard-pod sh
</pre></div>
</td></tr></table>

<p>By default, <code>kubectl</code> will execute the command against the first container in the <code>spec.containers</code> list. </p>
<p>To specify which Pod you want to access, use the <code>--container</code> (or <code>-c</code>) option along with the container name:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl exec -it kuard-pod --container kuard sh
</pre></div>
</td></tr></table>

<p>Now let's see how Kubernetes reacts to us setting the kuard container to an unhealthy state.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl port-forward kuard-pod 8080:8080
</pre></div>
</td></tr></table>

<p>Then in another terminal:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>make event-stream
</pre></div>
</td></tr></table>

<p>Or...</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>make watch-pods
</pre></div>
</td></tr></table>

<p>Now let's set go to http://localhost:8080/ and set the health to unhealthy and we'll watch Kubernetes give it a chance to recover, then when it exceeds the unhealthy count threshold, kill the Pod and replace it with another.</p>
<h2 id="a-debugging-pod">A debugging Pod<a class="headerlink" href="#a-debugging-pod" title="Permanent link">&para;</a></h2>
<p>Sometimes you may want to inject a Pod into the current namespace for introspection purposes.</p>
<p>First, let's get the IP of the kuard Pod.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl get pods kuard-pod -o wide
</pre></div>
</td></tr></table>

<p>Then, with a single command, we can launch a deployment and exec into our debugging container.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>make debug-container-up
</pre></div>
</td></tr></table>

<p>Now let's try hitting the Pod directly using its IP address.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>wget &lt;IP&gt;:8080 -q -O -
</pre></div>
</td></tr></table>

<p>We're going to use this debug container later when we look at services.</p>
<p>For now, let's exit. As a result of exiting, it should also kill the deployment. Verify by running.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl get deployments
</pre></div>
</td></tr></table>

<p>If you can still see your debug container running, then use the following command to delete it.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>make debug-container-down
</pre></div>
</td></tr></table>

<p>Finally, remove the kuars Pod:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl delete -f manifests/pod.yaml
</pre></div>
</td></tr></table>

<!--
## TODO

 - OOM killing
 - Show what happens when you change certain set only fields (ports) vs labels or names.
 - Add horizontal Pod auto-scaling example - https://kubernetes.io/docs/tasks/run-application/horizontal-Pod-autoscale/
 - Example of assigning Pods to a specific node.
-->
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../namespaces/" title="Namespaces" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Namespaces
              </span>
            </div>
          </a>
        
        
          <a href="../services/" title="Services" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Services
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.3",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>